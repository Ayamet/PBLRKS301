{% set is_admin = current_user.is_authenticated and current_user.role == 'admin' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{% block title %}{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </head>
<body>
    
    <nav class="navbar navbar-expand-lg fixed-top bg-white shadow-sm">
        <div class="container-fluid">
            
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}" style="gap:0.5rem;">
                <img src="{{ url_for('static', filename='images/logopeb.png') }}" alt="NemuKerja Logo" width="50" height="50" class="d-inline-block align-top">
                <span class="fw-bold text-primary ms-1 d-none d-sm-inline align-middle brand-text" data-i18n="site_name_id">NemuKerja</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbarCollapse" aria-controls="mainNavbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="mainNavbarCollapse">
                
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    
                    {% if current_user.is_authenticated and not is_admin %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'dashboard' %}nav-link-active{% endif %}" href="{{ url_for('dashboard') }}">
                            <span data-i18n="nav_dashboard_en">Dashboard</span>
                            <span data-i18n="nav_dashboard_id" class="d-none">Dasbor</span>
                        </a>
                    </li>
                    {% endif %}

                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'index' %}nav-link-active{% endif %}" href="{{ url_for('index') }}">
                            <span data-i18n="nav_home_en">Home</span>
                            <span data-i18n="nav_home_id" class="d-none">Beranda</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'about' %}nav-link-active{% endif %}" href="{{ url_for('about') }}">
                            <span data-i18n="nav_about_en">About Us</span>
                            <span data-i18n="nav_about_id" class="d-none">Tentang Kami</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'contact' %}nav-link-active{% endif %}" href="{{ url_for('contact') }}">
                            <span data-i18n="nav_contact_en">Contact</span>
                            <span data-i18n="nav_contact_id" class="d-none">Kontak</span>
                        </a>
                    </li>
                    
                    {% if is_admin %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if request.endpoint.startswith('admin_') %}nav-link-active{% endif %}" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <span data-i18n="nav_admin_manage_en">Management</span>
                            <span data-i18n="nav_admin_manage_id" class="d-none">Manajemen</span>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                            <li><a class="dropdown-item" href="{{ url_for('admin_dashboard') }}">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                <span data-i18n="admin_nav_dashboard_en">Admin Dashboard</span>
                                <span data-i18n="admin_nav_dashboard_id" class="d-none">Dasbor Admin</span>
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('admin_users') }}">
                                <i class="fas fa-users me-2"></i>
                                <span data-i18n="admin_nav_users_en">Manage Users</span>
                                <span data-i18n="admin_nav_users_id" class="d-none">Kelola Pengguna</span>
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('admin_companies') }}">
                                <i class="fas fa-building me-2"></i>
                                <span data-i18n="admin_nav_companies_en">Manage Companies</span>
                                <span data-i18n="admin_nav_companies_id" class="d-none">Kelola Perusahaan</span>
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('admin_jobs') }}">
                                <i class="fas fa-briefcase me-2"></i>
                                <span data-i18n="admin_nav_jobs_en">Manage Jobs</span>
                                <span data-i18n="admin_nav_jobs_id" class="d-none">Kelola Pekerjaan</span>
                            </a></li>
                        </ul>
                    </li>
                    {% endif %}
                </ul>

                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    
                    <li class="nav-item dropdown">
                        <a id="langDropdown" class="nav-link dropdown-toggle lang-dropdown-btn" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Change language">
                            <i class="fa fa-language" aria-hidden="true"></i>
                            <span id="current-lang">English</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end lang-menu" aria-labelledby="langDropdown">
                            <li><a class="dropdown-item lang-option" href="#" data-lang="en">English</a></li>
                            <li><a class="dropdown-item lang-option" href="#" data-lang="id">Bahasa Indonesia</a></li>
                        </ul>
                    </li>

                    {% if current_user.is_authenticated %}
                        {% if not is_admin %}
                        <li class="nav-item dropdown">
                            <a class="nav-link" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="View notifications">
                                <i class="fas fa-bell"></i>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notificationBadge" style="display: none;">0</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown" style="min-width: 350px; max-height: 400px; overflow-y: auto;">
                                <li class="dropdown-header d-flex justify-content-between align-items-center">
                                    <span>
                                        <span data-i18n="notifications_en">Notifications</span>
                                        <span data-i18n="notifications_id" class="d-none">Notifikasi</span>
                                    </span>
                                    <div class="btn-group btn-group-sm" role="group" aria-label="Notification actions">
                                        <button class="btn btn-sm btn-outline-secondary" id="markAllReadBtn">
                                            <span data-i18n="mark_all_read_en">Mark all read</span>
                                            <span data-i18n="mark_all_read_id" class="d-none">Tandai semua dibaca</span>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" id="clearAllBtn" title="Clear all notifications" aria-label="Clear all notifications">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <div id="notificationList"></div>
                            </ul>
                        </li>
                        {% endif %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user me-1"></i>
                                <span>{{ current_user.name }}</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                                
                                {% if not is_admin %}
                                <li><a class="dropdown-item" href="{{ url_for('profile') }}">
                                    <i class="fas fa-user-circle me-2"></i>
                                    <span data-i18n="profile_view_en">View Profile</span>
                                    <span data-i18n="profile_view_id" class="d-none">Lihat Profil</span>
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                {% endif %}
                                
                                <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
                                    <i class="fas fa-sign-out-alt me-2"></i>
                                    <span data-i18n="btn_logout_en">Logout</span>
                                    <span data-i18n="btn_logout_id" class="d-none">Keluar</span>
                                </a></li>
                            </ul>
                        </li>

                    {% else %}
                        
                        <li class="nav-item">
                            <a class="btn btn-outline-primary btn-sm me-2" href="{{ url_for('login') }}">
                                <span data-i18n="btn_login_en">Login</span>
                                <span data-i18n="btn_login_id" class="d-none">Masuk</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-primary btn-sm" href="{{ url_for('register') }}">
                                <span data-i18n="btn_register_en">Register</span>
                                <span data-i18n="btn_register_id" class="d-none">Daftar</span>
                            </a>
                        </li>

                    {% endif %}
                </ul> </div> </div> </nav>
    
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}

                    {% set i18n_flash = {
                        'login_invalid': {
                            'en': 'Invalid email or password.',
                            'id': 'Email atau kata sandi tidak valid.'
                        },
                        'register_email_exists': {
                            'en': 'Email already registered.',
                            'id': 'Email sudah terdaftar.'
                        },
                        'register_success': {
                            'en': 'Account created successfully! Please login.',
                            'id': 'Akun berhasil dibuat! Silakan masuk.'
                        },
                        'reactivate_info': {
                            'en': 'If your email exists in our system, a reactivation link has been sent.',
                            'id': 'Jika email Anda ada di sistem kami, link reaktivasi telah dikirimkan.'
                        },
                        'token_invalid': {
                            'en': 'Your token is invalid or has expired.',
                            'id': 'Token Anda tidak valid atau sudah kedaluwarsa.'
                        },
                        'reset_success': {
                            'en': 'Your password has been updated! Please login.',
                            'id': 'Password Anda telah diperbarui! Silakan masuk.'
                        },
                        'auth_required': {
                            'en': 'Please log in to access this page.',
                            'id': 'Silakan masuk untuk mengakses halaman ini.'
                        },
                        'applicant_only': {
                            'en': 'Only applicants can access this page.',
                            'id': 'Hanya pelamar yang dapat mengakses halaman ini.'
                        },
                        'applicant_profile_not_found': {
                            'en': 'Applicant profile not found.',
                            'id': 'Profil pelamar tidak ditemukan.'
                        },
                        'company_only': {
                            'en': 'Only company accounts can access this page.',
                            'id': 'Hanya akun perusahaan yang dapat mengakses halaman ini.'
                        },
                        'company_profile_saved': {
                            'en': 'Company profile saved.',
                            'id': 'Profil perusahaan disimpan.'
                        },
                        'company_profile_required': {
                            'en': 'Please complete your company profile first.',
                            'id': 'Harap lengkapi profil perusahaan Anda terlebih dahulu.'
                        },
                        'apply_slot_full': {
                            'en': 'Job application slot is full.',
                            'id': 'Slot lamaran untuk pekerjaan ini sudah penuh.'
                        },
                        'apply_job_closed': {
                            'en': 'This job is currently not open for applications.',
                            'id': 'Pekerjaan ini saat ini tidak terbuka untuk lamaran.'
                        },
                        'apply_already_applied': {
                            'en': 'You have already applied for this job.',
                            'id': 'Anda sudah melamar pekerjaan ini.'
                        },
                        'apply_cv_error': {
                            'en': 'Error uploading CV file.',
                            'id': 'Terjadi kesalahan saat mengunggah file CV.'
                        },
                        'apply_success': {
                            'en': 'Application submitted successfully! Wait for company response.',
                            'id': 'Lamaran berhasil dikirim! Tunggu respons perusahaan.'
                        },
                        'unauthorized': {
                            'en': 'Unauthorized access.',
                            'id': 'Akses tidak sah.'
                        },
                        'unauthorized_job': {
                            'en': 'You are not authorized to manage this job.',
                            'id': 'Anda tidak berwenang mengelola pekerjaan ini.'
                        },
                        'job_closed': {
                            'en': 'Job has been closed.',
                            'id': 'Lowongan pekerjaan telah ditutup.'
                        },
                        'job_reopened': {
                            'en': 'Job has been reopened.',
                            'id': 'Lowongan pekerjaan telah dibuka kembali.'
                        },
                        'job_close_first': {
                            'en': 'Job must be closed before deletion.',
                            'id': 'Pekerjaan harus ditutup sebelum bisa dihapus.'
                        },
                        'job_deleted': {
                            'en': 'Job has been successfully deleted.',
                            'id': 'Pekerjaan telah berhasil dihapus.'
                        },
                        'job_added': {
                            'en': 'Job added successfully.',
                            'id': 'Pekerjaan berhasil ditambahkan.'
                        },
                        'job_updated': {
                            'en': 'Job updated.',
                            'id': 'Pekerjaan diperbarui.'
                        },
                        'unauthorized_app': {
                            'en': 'You are not authorized to manage this application.',
                            'id': 'Anda tidak berwenang mengelola lamaran ini.'
                        },
                        'app_accepted': {
                            'en': 'Application accepted.',
                            'id': 'Lamaran diterima.'
                        },
                        'app_rejected': {
                            'en': 'Application rejected.',
                            'id': 'Lamaran ditolak.'
                        },
                        'unauthorized_view_app': {
                            'en': 'You are not authorized to view this application.',
                            'id': 'Anda tidak berwenang melihat lamaran ini.'
                        },
                        'admin_required': {
                            'en': 'Admin access required.',
                            'id': 'Akses admin diperlukan.'
                        },
                        'profile_updated': {
                            'en': 'Profile updated successfully!',
                            'id': 'Profil berhasil diperbarui!'
                        }
                    } %}

                    <div id="flash-messages-container" aria-live="polite" aria-atomic="true">
                        {% for category, message in messages %}
                            <div class="flash-message alert alert-{{ 'danger' if category == 'error' else category }} fade show" role="alert">

                                {% if i18n_flash[message] %}
                                    <span data-i18n="flash_{{ message }}_en">{{ i18n_flash[message].en }}</span>
                                    <span data-i18n="flash_{{ message }}_id" class="d-none">{{ i18n_flash[message].id }}</span>
                                {% else %}
                                    {{ message }}
                                {% endif %}

                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

    <main class="main-content py-5">
        {% block content %}{% endblock %}
    </main>

    <div class="modal fade" id="jobDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-0 shadow-lg rounded-3">
                <div class="modal-header bg-primary text-white border-0 rounded-top-3 p-4">
                    <h5 class="modal-title h4 fw-bold d-flex align-items-center" id="jobDetailTitle">
                        <i class="fas fa-briefcase me-3"></i>
                        <span data-i1B8n="index_job_details_en">Job Details</span>
                        <span data-i18n="index_job_details_id" class="d-none">Detail Pekerjaan</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4" id="jobDetailBody">
                    </div>
                <div class="modal-footer border-top-0 bg-light p-3">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <span data-i18n="btn_close_en">Close</span>
                        <span data-i18n="btn_close_id" class="d-none">Tutup</span>
                    </button>
                    <span id="applyButtonContainer">
                        </span>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        window.isAuthenticated = {{ current_user.is_authenticated|tojson|safe }};
        window.currentUserRole = "{{ current_user.role if current_user.is_authenticated else '' }}";
    </script>
</body>
</html>